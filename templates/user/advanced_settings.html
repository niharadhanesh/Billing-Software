{% extends 'user/user_dashboard.html' %}
{% block content %}
{% load custom_filters %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"> -->

<style>
  body {
    padding-top: 70px;
    background-color: #f8f9fa;
  }

  .navbar {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
  }

  .panel {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
  }

  .user-list li {
    cursor: pointer;
    padding: 8px 10px;
    border-bottom: 1px solid #eee;
  }

  .user-list li:last-child {
    border-bottom: none;
  }

  .user-list li.active-user,
  .user-list li:hover {
    background-color: #e9ecef;
  }

  .user-list-scroll {
    max-height: 300px; 
    overflow-y: auto;
    border: 1px solid #dee2e6;
    border-radius: 5px;
    margin-bottom: 10px; 
  }

  @media (max-width: 1024px) {
    .top-buttons {
      margin-top: 50px !important;
    }
  }

  @media (max-width: 768px) {
    .top-buttons {
      margin-top: 0 !important;
    }
  }

  .custom-btn {
    width: 110px;
    height: 100px;
    padding: 12px 8px;
    line-height: 1.2;
    text-align: center;
    white-space: normal;
    word-wrap: break-word;
  }

  .settings-scroll-container {
    overflow-x: auto;
    white-space: nowrap;
    padding-bottom: 5px;
  }

  .settings-scroll-container::-webkit-scrollbar {
    height: 6px;
  }

  .settings-scroll-container::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 10px;
  }

  .settings-scroll-container .btn {
    min-width: 150px;
    text-align: center;
    white-space: normal;
    margin-right: 2px;
    border-radius: 0;
    border: 1px solid #dee2e6;
    background-color: #f8f9fa;
    color: #495057;
    transition: 0.2s ease-in-out;
  }

    /* .settings-scroll-container .btn.active-setting {
    background-color: #FFAA17;
    color: white;
    font-weight: 500;
    z-index: 1;
  } */

  .card {
    border-radius: 10px;
    background-color: #fff;
  }

  #adminPanelContent {
    display: none;
  }
  .btn-close.btn-close-white {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M2.146 2.146a.5.5 0 011 0L8 6.293l4.854-4.854a.5.5 0 11.708.708L8.707 7l4.854 4.854a.5.5 0 01-.708.708L8 7.707l-4.854 4.854a.5.5 0 01-.708-.708L7.293 7 2.146 2.854a.5.5 0 010-.708z'/%3E%3C/svg%3E");
  filter: none;
  opacity: 1;
}
  #userProfileView input {
    font-size: 1rem;
    min-width: 5%;
    padding: 10px;
  }

  @media (max-width: 768px) {
    #userProfileView .row {
      flex-direction: column;
    }

    #userProfileView .col-md-4 {
      width: 100% !important;
      margin-bottom: 10px;
    }

    #userProfileView button {
      width: 100%;
    }
  }
  .modal-backdrop {
  opacity: 0.2 !important;
}
  .invoice-preview {
    background: white;
    border: 1px solid #ddd;
    font-size: 14px;
    font-family: Arial, sans-serif;
  }

  .custom-invoice-table th {
    background-color: orange !important;
    color: white;
    border: 1px solid #ccc;
  }

  .custom-invoice-table td {
    border: 1px solid #ccc;
    vertical-align: middle;
  }

  .custom-invoice-table .no-left-border td:first-child {
    border-left: none;
  }

  .custom-invoice-table .text-end {
    text-align: right;
  }
    .invoice-preview {
        box-sizing: border-box; 
        position: relative; 
    }

    .invoice-preview.a4 {
        width: 210mm;
        min-height: 297mm; 
    }

    .invoice-preview.letter {
        width: 215.9mm; 
        min-height: 279.4mm;
    }

    .logo-section {
        position: relative; 
    }

    .bill-ship-to-section {
        position: relative; 
    }

</style>

<div class="container">
  <div class="d-flex justify-content-start mb-3 top-buttons gap-2">
  <a href="#" class="btn btn-outline-primary custom-btn text-center" data-bs-toggle="modal" data-bs-target="#quickWizardModal">
  <i class="fas fa-play fa-lg mb-1"></i><br>
  Quick Start<br>Wizard
</a>


    <a href="#" class="btn btn-outline-primary custom-btn text-center">
      <i class="fas fa-book fa-lg mb-1"></i><br>
      Online<br>User Manual
    </a>
    <a href="#" class="btn btn-outline-primary custom-btn text-center">
      <i class="fas fa-circle-up fa-lg mb-1"></i><br>
      Upgrade to<br>PRO Now
    </a>
  </div>
  

  <div class="card shadow-sm p-3">
    <div class="settings-scroll-container mb-3 border-bottom pb-2">
      <div class="d-flex flex-nowrap gap-1" id="settingTabs">
        <a href="{% url 'user_miscellaneous_settings' %}" class="btn btn-light flex-shrink-0">Miscellaneous</a>
        <a href="{% url 'user_settings' %}?open=company" class="btn btn-light flex-shrink-0">Company Settings</a>
        <a href="{% url 'user_invoice_settings' %}?section=invoice" class="btn btn-light flex-shrink-0">Invoice Settings</a>
        <a href="{% url 'user_order_settings' %}?section=order" class="btn btn-light flex-shrink-0">Order Settings</a>
        <a href="{% url 'user_estimate_settings' %}?section=estimate" class="btn btn-light flex-shrink-0">Estimate Settings</a>
        <a href="{% url 'user_advanced_settings' %}" class="btn btn-light flex-shrink-0">Advanced Settings</a>
          <a href="{% url 'user_email_templates' %}" class="btn btn-light flex-shrink-0">Email Templates</a>
          <a href="{% url 'user_payment_settings_view' %}" class="btn btn-light flex-shrink-0">payments</a>
        <a href="{% url 'user_purchase_order' %}?section=purchase" class="btn btn-light flex-shrink-0">Purchase Order</a>
      </div>
    </div>

  <div id="settingsContent" class="mt-3">

  <!-- Miscellaneous Settings -->
  <div id="MiscSettingsContent" style="display: none;">
    <p>Miscellaneous Settings</p>
  </div>

<!-- Other Settings Sections -->
  <div id="InvoiceSettingsContent" style="display: none;">
    <p>Invoice Settings</p>
  </div>

  <div id="OrderSettingsContent" style="display: none;">
    <p>Order Settings</p>
  </div>

  <div id="EstimateSettingsContent" style="display: none;">
    <p>Estimate Settings</p>
  </div>




<div id="AdvancedSettingsContent">
    <h4 class="mb-4">Template Advanced Settings</h4>
<form id="companySettingsForm" enctype="multipart/form-data" method="post" action="{% url 'user_advanced_template_settings' %}">
  {% csrf_token %}
    <div class="row gy-4">
      <!-- Left Column -->
      <div class="col-lg-4 col-md-6">
        <h6 class="mb-3">Templates</h6>
        <div class="mb-3 row align-items-center">
          <label class="col-6 col-form-label">Professional 1 (Logo on the Left)</label>
          <div class="col-6">
            <select class="form-select" id="pageSizeInput" name="template1_page_size">
              <option value="A4">A4</option>
              <option value="Letter">Letter</option>
            </select>
          </div>
        </div>
        <div class="mb-3 row align-items-center">
          <label class="col-6 col-form-label">Professional 2 (Logo on the Right)</label>
          <div class="col-6">
            <select class="form-select" id="pageSizeInput" name="template2_page_size">
              <option value="A4">A4</option>
              <option value="Letter">Letter</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Center Column -->
      <div class="col-lg-3 col-md-6">
        <h6 class="mb-3">Right margin (mm)</h6>
        <div class="row mb-3 align-items-center">
          <label class="col-5 col-form-label">Left</label>
          <div class="col-7">
            <input type="number" name="template1_right_margin" id="rightMarginInput" class="form-control" placeholder="e.g. 10">
          </div>
        </div>
        <div class="row mb-3 align-items-center">
          <label class="col-5 col-form-label">Left</label>
          <div class="col-7">
            <input type="number" name="template2_right_margin" class="form-control" placeholder="e.g. 15">
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="col-lg-5">
        <h6 class="mb-3">Invoice To Block Position Shift (mm)</h6>
        <div class="row g-3">
          <!-- Row 1 -->
          <div class="col-6 d-flex align-items-center gap-2">
            <label class="form-label mb-0" style="width: 50px;">Left</label>
            <input type="number" name="template1_shift_left" class="form-control" placeholder="e.g. 5">
          </div>
          <div class="col-6 d-flex align-items-center gap-2">
            <label class="form-label mb-0" style="width: 50px;">Top</label>
            <input type="number" name="template1_shift_top" class="form-control" placeholder="e.g. 10">
          </div>
          <!-- Row 2 -->
          <div class="col-6 d-flex align-items-center gap-2">
            <label class="form-label mb-0" style="width: 50px;">Left</label>
            <input type="number" name="template2_shift_left" class="form-control" placeholder="e.g. 3">
          </div>
          <div class="col-6 d-flex align-items-center gap-2">
            <label class="form-label mb-0" style="width: 50px;">Top</label>
            <input type="number" name="template2_shift_top" class="form-control" placeholder="e.g. 7">
          </div>
        </div>
      </div>
    </div>

    <!-- Buttons -->
    <div class="mt-4 text-end d-flex flex-wrap gap-2 justify-content-end">
      <button type="button" class="btn btn-secondary" id="refreshPreviewButton">Refresh Preview</button>
      <button type="submit" class="btn" style="background-color: #FFAA17;color: white;">Save Settings</button>
      <button type="submit" class="btn btn-danger" id="restoreButton">
        Restore Default
      </button>
    </div>
</form>


<!-- Invoice Preview -->
<div class="mt-5">
  <h5 class="mb-3">Invoice Template Preview</h5>
  <div class="mb-3" style="max-width: 300px;">
    <label for="templateSelector" class="form-label">Select Template</label>
    <select id="templateSelector" class="form-select" onchange="toggleTemplatePreview(this.value)">
      <option value="template1" selected>Professional 1 (Logo Left Side)</option>
      <option value="template2">Professional 2 (Logo Right Side)</option>
    </select>
  </div>

  <!-- Scrollable Outer Box -->
  <div style="border: 1px solid #ccc; padding: 20px; background-color: #f1f4fa; max-height: 500px; overflow-y: auto; overflow-x: auto;">
    <div style="min-width: 820px;">
      <!-- Template 1 -->
      <div id="template1" class="invoice-preview bg-white p-4 shadow-sm mx-auto d-flex flex-column" style="width: 800px; min-height: 1122px;" data-page-size="{{ template1_obj.page_size }}"
                     data-right-margin-mm="{{ template1_obj.right_margin_mm|default:0 }}"
                     data-shift-left-mm="{{ template1_obj.invoice_block_shift_left_mm|default:0 }}"
                     data-shift-top-mm="{{ template1_obj.invoice_block_shift_top_mm|default:0 }}">
      
                     
        <!-- Header Section -->
        <div>
          <div class="d-flex justify-content-between align-items-start mb-4">
            <div>
              <img src="{{ logo.image.url }}" alt="Logo" class="mb-2" style="max-height: 60px;"><br>
              <div><strong>Invoice #:</strong> 001</div>
              <div><strong>Invoice Date:</strong> 2025-06-18</div>
              <div><strong>Due Date:</strong> 2025-06-25</div>
              <div><strong>Terms:</strong> Due on receipt</div>
              <div><strong>Order #:</strong> 456</div>
            </div>
            <div class="text-end">
              <h5 class="mb-1">{{ company.company_name }}</h5>
              <div>{{ company.address }}</div>
              <div>Phone: +91-1234567890</div>
              <div>{{ company.sales_tax_reg_no }}</div>
              <h2 class="fw-bold mt-2">INVOICE</h2>
              <div class="text-muted">Tax Exempted</div>
            </div>
          </div>

          <!-- Bill To / Ship To -->
          <div class="row mb-5">
            <div class="col-6">
              <strong>Invoice To</strong>
              <hr class="my-1">
              <div>Jane Doe</div>
              <div>456 Another St, City</div>
            </div>
            <div class="col-6 text-end">
              <strong>Ship To</strong>
              <hr class="my-1">
              <div>John Smith</div>
              <div>789 Delivery Lane, City</div>
            </div>
          </div>

          <!-- Table -->
          <table class="table custom-invoice-table mb-4">
            <thead class="table-warning">
              <tr>
                <th>ID/SKU</th>
                <th>Product/Service Description</th>
                <th class="text-end">Quantity</th>
                <th class="text-end">Unit Price</th>
                <th class="text-end">Price</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>PRO-0001</td>
                <td>aaaaaaaaa</td>
                <td class="text-end">1</td>
                <td class="text-end">200.00</td>
                <td class="text-end">200.00</td>
              </tr>

              <!-- Totals Section -->
              <tr>
                <td colspan="2" style="border: none;"></td>
                <td class="text-start"><strong>Subtotal:</strong></td>
                <td colspan="2" class="text-end">200.00</td>
              </tr>
              <tr>
                <td colspan="2" style="border: none;"></td>
                <td class="text-start"><strong>Tax 1:</strong></td>
                <td colspan="2" class="text-end">18.00</td>
              </tr>
              <tr>
                <td colspan="2" style="border: none;"></td>
                <td class="text-start"><strong>Tax 2:</strong></td>
                <td colspan="2" class="text-end">0.00</td>
              </tr>
              <tr>
                <td colspan="2" style="border: none;"></td>
                <td class="text-start"><strong>Shipping & Handling:</strong></td>
                <td colspan="2" class="text-end">20.00</td>
              </tr>
              <tr>
                <td colspan="2" style="border: none;"></td>
                <td class="text-start"><strong>Invoice Total:</strong></td>
                <td colspan="2" class="text-end fw-bold">238.00</td>
              </tr>
              <tr>
                <td colspan="2" style="border: none;"></td>
                <td class="text-start"><strong>Total Paid:</strong></td>
                <td colspan="2" class="text-end">100.00</td>
              </tr>
              <tr>
                <td colspan="2" style="border: none;"></td>
                <td class="text-start"><strong>Balance:</strong></td>
                <td colspan="2" class="text-end text-danger fw-bold">138.00</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Spacer pushes this to bottom -->
        <div class="flex-grow-1"></div>

        <!-- Terms & Conditions -->
        <div class="mt-4">
          <h6 style="text-decoration: underline;">Terms and Conditions</h6>
          <p>Invoices are table on receipt and less other teams, negotiated and noted on the invoice. By accepting delivery of goods by yes agrees to pay the invoiced cost for those goods, and agrees to be bound to these contract terms. No acceptance maybe these terms and less specification writing by Aaaaaaaaa.</p>
        </div>
      </div>


        <!-- Template 2 Placeholder -->
  <div id="template2" class="invoice-preview bg-white p-4 shadow-sm mx-auto d-flex flex-column d-none" style="width: 800px; min-height: 1122px;"  data-page-size="{{ template2_obj.page_size }}"
                     data-right-margin-mm="{{ template2_obj.right_margin_mm|default:0 }}"
                     data-shift-left-mm="{{ template2_obj.invoice_block_shift_left_mm|default:0 }}"
                     data-shift-top-mm="{{ template2_obj.invoice_block_shift_top_mm|default:0 }}">
    
    <div class="d-flex justify-content-between align-items-start mb-4">
      <!-- Company Info Left -->
      <div>
        <h5 class="mb-1">{{ company.company_name }}</h5>
        <div>{{ company.address }}</div>
        <div>Phone: +91-1234567890</div>
        <div>{{ company.sales_tax_reg_no }}</div>
        <h2 class="fw-bold mt-2">INVOICE</h2>
        <div class="text-muted">Tax Exempted</div>
      </div>

      <!-- Logo Right -->
      <div class="text-end">
        <img src="{{ logo.image.url }}" alt="Logo" class="mb-2" style="max-height: 60px;"><br>
        <div><strong>Invoice #:</strong> 001</div>
        <div><strong>Invoice Date:</strong> 2025-06-18</div>
        <div><strong>Due Date:</strong> 2025-06-25</div>
        <div><strong>Terms:</strong> Due on receipt</div>
        <div><strong>Order #:</strong> 456</div>
      </div>
    </div>

  <!-- Bill To / Ship To -->
            <div class="row mb-5">
              <div class="col-6">
                <strong>Invoice To</strong>
                <hr class="my-1">
                <div>Jane Doe</div>
                <div>456 Another St, City</div>
              </div>
              <div class="col-6 text-end">
                <strong>Ship To</strong>
                <hr class="my-1">
                <div>John Smith</div>
                <div>789 Delivery Lane, City</div>
              </div>
            </div>

            <!-- Table -->
            <table class="table custom-invoice-table mb-4">
              <thead class="table-warning">
                <tr>
                  <th>ID/SKU</th>
                  <th>Product/Service Description</th>
                  <th class="text-end">Quantity</th>
                  <th class="text-end">Unit Price</th>
                  <th class="text-end">Price</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>PRO-0001</td>
                  <td>aaaaaaaaa</td>
                  <td class="text-end">1</td>
                  <td class="text-end">200.00</td>
                  <td class="text-end">200.00</td>
                </tr>

                <!-- Totals Section -->
                <tr>
                  <td colspan="2" style="border: none;"></td>
                  <td class="text-start"><strong>Subtotal:</strong></td>
                  <td colspan="2" class="text-end">200.00</td>
                </tr>
                <tr>
                  <td colspan="2" style="border: none;"></td>
                  <td class="text-start"><strong>Tax 1:</strong></td>
                  <td colspan="2" class="text-end">18.00</td>
                </tr>
                <tr>
                  <td colspan="2" style="border: none;"></td>
                  <td class="text-start"><strong>Tax 2:</strong></td>
                  <td colspan="2" class="text-end">0.00</td>
                </tr>
                <tr>
                  <td colspan="2" style="border: none;"></td>
                  <td class="text-start"><strong>Shipping & Handling:</strong></td>
                  <td colspan="2" class="text-end">20.00</td>
                </tr>
                <tr>
                  <td colspan="2" style="border: none;"></td>
                  <td class="text-start"><strong>Invoice Total:</strong></td>
                  <td colspan="2" class="text-end fw-bold">238.00</td>
                </tr>
                <tr>
                  <td colspan="2" style="border: none;"></td>
                  <td class="text-start"><strong>Total Paid:</strong></td>
                  <td colspan="2" class="text-end">100.00</td>
                </tr>
                <tr>
                  <td colspan="2" style="border: none;"></td>
                  <td class="text-start"><strong>Balance:</strong></td>
                  <td colspan="2" class="text-end text-danger fw-bold">138.00</td>
                </tr>
              </tbody>
            </table>

          <!-- Spacer pushes this to bottom -->
          <div class="flex-grow-1"></div>

          <!-- Terms & Conditions -->
          <div class="mt-4">
            <h6 style="text-decoration: underline;">Terms and Conditions</h6>
            <p>Invoices are table on receipt and less other teams, negotiated and noted on the invoice. By accepting delivery of goods by yes agrees to pay the invoiced cost for those goods, and agrees to be bound to these contract terms. No acceptance maybe these terms and less specification writing by Aaaaaaaaa.</p>
          </div>
        </div>
      </div>
      </div>
      </div>
    </div>
  </div>
  </div>

  <div id="EmailSettingsContent" style="display: none;">
    <p>Email Templates</p>
  </div>

  <div id="PaymentsSettingsContent" style="display: none;">
    <p>Payments Settings</p>
  </div>

  <div id="PurchaseSettingsContent" style="display: none;">
    <p>Purchase Order Settings</p>
  </div>

  </div>
</div>

</div>

<script>
  function showSection(button, section) {
    document.querySelectorAll('#settingTabs .btn, #settingTabs a').forEach(tab => {
      tab.classList.remove('active-setting');
    });

    if (button) {
      button.classList.add('active-setting');
    }

    const allSections = [
      'MiscSettingsContent',
      'CompanySettingsContent',
      'InvoiceSettingsContent',
      'OrderSettingsContent',
      'EstimateSettingsContent',
      'AdvancedSettingsContent',
      'EmailSettingsContent',
      'PaymentsSettingsContent',
      'PurchaseSettingsContent'
    ];

    allSections.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = 'none';
    });

    const currentSection = document.getElementById(
      section.charAt(0).toUpperCase() + section.slice(1) + 'SettingsContent'
    );
    if (currentSection) {
      currentSection.style.display = 'block';
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    const path = window.location.pathname;

    document.querySelectorAll('#settingTabs .btn, #settingTabs a').forEach(tab => {
      tab.classList.remove('active-setting');
    });

    if (path.includes('user_settings')) {
      const companySection = document.getElementById('CompanySettingsContent');
      const companyTab = document.querySelector('#settingTabs a[href*="user_settings"]');
      if (companySection) companySection.style.display = 'block';
      if (companyTab) companyTab.classList.add('active-setting');
    }

    else if (path.includes('user_advanced_settings')) {
      const advancedTab = document.querySelector('#settingTabs a[href*="user_advanced_settings"]');
      if (advancedTab) advancedTab.classList.add('active-setting');
    }

    else {
      const defaultBtn = document.querySelector('#settingTabs button[onclick*="misc"]');
      if (defaultBtn) {
        showSection(defaultBtn, 'misc');
      }
    }
  });
</script>

<script>
    function applyTemplateStyles(templateId) {
        document.querySelectorAll('.template-content').forEach(templateDiv => {
            templateDiv.style.display = 'none';
        });

        const container = document.getElementById(templateId);

        if (!container) {
            console.warn(`Preview container not found for templateId: ${templateId}`);
            return;
        }

        container.style.display = 'flex';

        const pageSize = container.dataset.pageSize;
        const rightMargin = parseFloat(container.dataset.rightMarginMm) || 0;
        const shiftLeft = parseFloat(container.dataset.shiftLeftMm) || 0;
        const shiftTop = parseFloat(container.dataset.shiftTopMm) || 0;

        console.log(`\n--- Applying Styles for ${templateId} ---`);
        console.log(`  Page Size: ${pageSize}`);
        console.log(`  Right Margin: ${rightMargin}mm`);
        console.log(`  Shift Left: ${shiftLeft}mm`);
        console.log(`  Shift Top: ${shiftTop}mm`);
        console.log("--------------------------------------------------");

        if (pageSize === "A4") {
            container.style.width = "800px";
            container.style.minHeight = "1122px";
        } else if (pageSize === "Letter") {
            container.style.width = "775px";
            container.style.minHeight = "1056px";
        } else {
            console.warn(`Unknown page size: ${pageSize}`);
        }

        const headerDflex = container.querySelector(".d-flex.justify-content-between.align-items-start.mb-4");
        if (headerDflex) {
            const rightBlock = headerDflex.querySelector(".text-end");
            if (rightBlock) {
                rightBlock.style.marginLeft = "auto";
                rightBlock.style.marginRight = rightMargin + "mm";
            }
        } else {
            console.warn("Header d-flex container not found for margin application.");
        }

        const invoiceToBox = container.querySelector(".row.mb-5");
        if (invoiceToBox) {
            if (shiftLeft !== 0) {
                invoiceToBox.style.marginLeft = shiftLeft + "mm";
            }
            if (shiftTop !== 0) {
                invoiceToBox.style.marginTop = shiftTop + "mm";
            }
        } else {
            console.warn("Invoice To/Ship To box (.row.mb-5) not found.");
        }
    }

    function populateInputFields(templateId) {
        const selectedPreviewDiv = document.getElementById(templateId);
        const templateMapping = {
            'template1': 'Professional 1',
            'template2': 'Professional 2'
        };

        if (selectedPreviewDiv) {
            document.getElementById("pageSizeInput").value = selectedPreviewDiv.dataset.pageSize;
            document.getElementById("rightMarginInput").value = selectedPreviewDiv.dataset.rightMarginMm;
            document.getElementById("shiftLeftInput").value = selectedPreviewDiv.dataset.shiftLeftMm;
            document.getElementById("shiftTopInput").value = selectedPreviewDiv.dataset.shiftTopMm;
            document.getElementById("selectedTemplateNameForSave").value = templateMapping[templateId];
        }
    }

    document.getElementById("templateSelector").addEventListener("change", function () {
        const selectedTemplate = this.value;
        populateInputFields(selectedTemplate);
        applyTemplateStyles(selectedTemplate);
    });

    document.getElementById("refreshPreviewButton").addEventListener("click", function () {
        const selectedTemplate = document.getElementById("templateSelector").value;
        console.log("--- 'Refresh Preview' clicked ---");
        applyTemplateStyles(selectedTemplate);
    });

    window.addEventListener("DOMContentLoaded", function () {
        const initialSelectedTemplate = document.getElementById("templateSelector").value;
        populateInputFields(initialSelectedTemplate);
        applyTemplateStyles(initialSelectedTemplate);
    });
</script>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("companySettingsForm");
    const restoreBtn = document.getElementById("restoreButton");

    restoreBtn.addEventListener("click", function (e) {
      const confirmed = confirm("Restore both templates to default settings?");
      if (!confirmed) {
        e.preventDefault();
        return;
      }

      form.action = "{% url 'user_restore_template_defaults' %}";
    });
  });
</script>

<script>
  function toggleTemplatePreview(selected) {
    document.getElementById('template1').classList.add('d-none');
    document.getElementById('template2').classList.add('d-none');
    document.getElementById(selected).classList.remove('d-none');
  }
</script>


<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script> -->

{% endblock %}


{% block global_modals %}
  {% include 'includes/quick_start_modal.html' %}
{% endblock %}